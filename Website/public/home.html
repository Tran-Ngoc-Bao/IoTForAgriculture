<!DOCTYPE html>
<html>

<head>
    <title>Trang chủ</title>
    <link rel="stylesheet" type="text/css" href="./style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Lấy tên
            const fullnameButton = document.getElementById('fullname');

            fetch('http://localhost:8000/api/user', {
                method: 'GET',
                headers: {
                    authorization: 'JWT ' + localStorage.getItem('token') // Gửi mã thông báo hoặc session trong tiêu đề Authorization
                }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Request failed');
                    }
                    return response.json();
                })
                .then(data => {
                    const userFullName = data.fullName;

                    fullnameButton.querySelector('a').textContent = userFullName;
                    fullnameButton.querySelector('a').href = './account.html';

                    localStorage.setItem('_id', data._id);
                    localStorage.setItem('fullName', data.fullName);
                    localStorage.setItem('email', data.email);
                    localStorage.setItem('adresses',  data.addresses.join(', '));
                })
                .catch(error => {
                    console.log(error);
                });
        });
    </script>
</head>

<body>
    <header>
        <div class="header-left" style="margin-top: 20px;">
            <h1>
                <pre> Nhóm BCHL</pre>
            </h1>
        </div>
        <nav class="header-center">
            <ul>
                <li><a href="./home.html">Trang chủ</a></li>&nbsp;&nbsp;&nbsp;&nbsp;
                <li><a href="https://github.com/TranNgocBao12062003/ProjectIOT">Liên hệ</a></li>
            </ul>
        </nav>
        <div class="header-right">
            <a href="./login.html"><button class="logout-button">Đăng xuất</button></a>
        </div>
    </header>

    <div class="chart-container">
        <div class="date-container">
            <div class="current-date">
                <h4 id="current-date"></h4>
            </div>
            <div class="date-select">
                <label for="date-input">Chọn ngày:</label>
                <input type="date" id="date-input">
                <button class="btn btn-primary" onclick="updateChart()">Xem</button>
            </div>
        </div>
        <canvas id="hourly-chart"></canvas>
    </div>

    <div class="table-container">
        <div class="current-data">
            <h5>Mực nước hiện tại (m): <p style="display: inline;">3.3</p>
            </h5>
        </div>
        <button class="account" id="fullname"><a href="./account.html">User</a></button>
        <div class="mb-3">
            <h5>Chọn khu vực</h5>
            <select class="form-select" aria-label="Khu vực">
                <option value="region1">Hà Nội</option>
                <option value="region2">Hòa Bình</option>
                <option value="region3">Lai Châu</option>
                <option value="region4">Nam Định</option>
                <option value="region5">Sơn La</option>
                <!-- Thêm các khu vực khác vào đây -->
            </select>
            <button class="custom-button OK" onclick="changeMap()">Chọn</button>
            <div class="map-container">
                <iframe
                    src="https://maps.google.com/maps?q=đại học bách khoa hà nội&t=&z=10&ie=UTF8&iwloc=&output=embed"
                    width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1"></script>
    <script>
        // Dữ liệu mẫu cho biểu đồ
        var hourlyData = {
            labels: ['0h', '1h', '2h', '3h', '4h', '5h', '6h', '7h', '8h', '9h', '10h', '11h', '12h', '13h', '14h', '15h', '16h', '17h', '18h', '19h', '20h', '21h', '22h', '23h'], // Các nhãn trục x
            datasets: [{
                label: 'Mực nước (m)',
                data: [5, 2.5, 4, 6, 3, 4.5, 5.5, 4, 6, 3, 4.5, 5.5, 5, 2.5, 4, 6, 3, 4.5, 5.5, 4, 6, 3, 4.5, 5.5], // Dữ liệu mực nước tương ứng với từng giờ
                backgroundColor: 'rgba(54, 162, 235, 0.5)', // Màu nền cột
                borderColor: 'rgba(54, 162, 235, 1)', // Màu viền cột
                borderWidth: 1 // Độ rộng viền cột
            }]
        };

        // Tạo biểu đồ
        var hourlyChart = new Chart(document.getElementById('hourly-chart'), {
            type: 'bar', // Loại biểu đồ là bar (hình cột)
            data: hourlyData,
            options: {
                responsive: true, // Biểu đồ có thể đáp ứng kích thước
                scales: {
                    y: {
                        beginAtZero: true // Bắt đầu trục y từ 0
                    }
                }
            }
        });

        // Lấy ngày tháng năm hôm nay
        var today = new Date();
        var currentDateElement = document.getElementById('current-date');
        currentDateElement.textContent = today.toLocaleDateString();

        // Lấy thẻ input và nút cập nhật
        var dateInput = document.getElementById('date-input');
        var updateButton = document.querySelector('.date-select button');

        // Sự kiện khi nút cập nhật được nhấn
        updateButton.addEventListener('click', function () {
            var selectedDate = dateInput.value;
            // Cập nhật biểu đồ với ngày tháng đã chọn
            updateChart(selectedDate);
        });

        // Hàm cập nhật biểu đồ với ngày tháng đã chọn
        function updateChart(selectedDate) {
            // Chuyển đổi chuỗi ngày tháng đã chọn thành đối tượng Date
            var date = new Date(selectedDate);

            // Lấy ngày, tháng và năm từ đối tượng Date
            var day = date.getDate();
            var month = date.getMonth() + 1; // Tháng bắt đầu từ 0, cần cộng thêm 1
            var year = date.getFullYear();

            // Hiển thị ngày tháng đã chọn
            var currentDateElement = document.getElementById('current-date');
            currentDateElement.textContent = day + '/' + month + '/' + year;

            // Thực hiện logic cập nhật biểu đồ với ngày tháng đã chọn
            // ...
            event.preventDefault(); // Ngăn trình duyệt tải lại trang
            var selectedDate = dateInput.value;
            // Cập nhật biểu đồ với ngày tháng đã chọn
            updateChartNew(selectedDate);
        }

        var region = document.querySelector('.form-select');
        var map = document.querySelector('iframe');

        function changeMap() {
            switch (region.value) {
                case "region1":
                    map.src = "https://maps.google.com/maps?q=nhà máy thủy điện hòa bình&t=&z=10&ie=UTF8&iwloc=&output=embed";
                    break;
                case "region2":
                    map.src = "https://maps.google.com/maps?q=Nhà máy thủy điện Lai Châu&t=&z=10&ie=UTF8&iwloc=&output=embed";
                    break;
                case "region3":
                    map.src = "https://maps.google.com/maps?q=tượng đài Trần Hưng Đạo&t=&z=10&ie=UTF8&iwloc=&output=embed";
                    break;
                case "region4":
                    map.src = "https://maps.google.com/maps?q=Nhà máy thủy điện Sơn La&t=&z=10&ie=UTF8&iwloc=&output=embed";
                    break;
                default:
                    map.src = "https://maps.google.com/maps?q=đại học bách khoa hà nội&t=&z=10&ie=UTF8&iwloc=&output=embed";
            }
        }

        // Sự kiện khi nút thay khu vực được nhấn
        map.addEventListener('click', function () {
            var regionValue = region.value;
            // Cập nhật biểu đồ với map đã chọn
            updateChartNew(regionValue);
        });

        function updateChartNew(regionValue) {
            // Thực hiện logic cập nhật biểu đồ với map đã chọn
            // ...
        }
    </script>

    <footer>
        <div class="footer-center">© Nhóm BCHL</div>
        <div class="footer-right">
            <span>GitHub:</span>
            <a href="https://github.com/TranNgocBao12062003/ProjectIOT">
                <i class="fab fa-github"></i>
            </a>
        </div>
    </footer>
</body>

</html>